<form id="contact-form" class="max-w-lg mx-auto bg-white shadow-lg p-8 rounded-lg" data-aos="fade-up">
  <h2 class="text-3xl font-bold text-dark mb-6 text-center">Contáctanos</h2>

  <!-- Honeypot -->
  <input type="text" name="empresa" id="empresa" class="hidden" autocomplete="off" tabindex="-1" />

  <label class="block mb-4">
    <span class="text-dark font-semibold">Nombre*</span>
    <input 
      type="text" 
      name="nombre" 
      required
      class="w-full border p-3 rounded mt-2 focus:outline-none focus:border-[var(--color-primary)]" 
    />
  </label>

  <label class="block mb-4">
    <span class="text-dark font-semibold">Email*</span>
    <input 
      type="email" 
      name="email" 
      required
      class="w-full border p-3 rounded mt-2 focus:outline-none focus:border-[var(--color-primary)]" 
    />
  </label>

  <label class="block mb-6">
    <span class="text-dark font-semibold">Mensaje*</span>
    <textarea 
      name="mensaje" 
      required 
      rows="5"
      class="w-full border p-3 rounded mt-2 focus:outline-none focus:border-[var(--color-primary)]"
    ></textarea>
  </label>

  <button
  type="submit"
  id="submit-btn"
  class="bg-[var(--color-primary)] w-full text-white py-3 font-semibold rounded-lg
         hover:opacity-90 transition
         flex items-center justify-center gap-2"
>
  <span class="btn-text">Enviar Mensaje</span>

  <!-- Spinner -->
  <svg
    class="btn-spinner hidden w-5 h-5 animate-spin text-white"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
  >
    <circle
      class="opacity-25"
      cx="12"
      cy="12"
      r="10"
      stroke="currentColor"
      stroke-width="4"
    ></circle>
    <path
      class="opacity-75"
      fill="currentColor"
      d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
    ></path>
  </svg>
</button>
</form>

<!-- Toast container -->
<div id="toast" class="fixed p-10 top-5 right-5 z-50 hidden"></div>

<script>
  function showToast(message, type = "success") {
    const toast = document.getElementById("toast");
    const div = document.createElement("div");
    div.className = `toast-msg toast-${type}`;
    div.textContent = message;
    toast.appendChild(div);
    toast.classList.remove("hidden");

    setTimeout(() => div.remove(), 4000);
  }

  const submitBtn = document.getElementById("submit-btn");

const btnText = submitBtn.querySelector(".btn-text");
const btnSpinner = submitBtn.querySelector(".btn-spinner");

function setLoading(isLoading) {
  if (isLoading) {
    submitBtn.disabled = true;
    submitBtn.classList.add("opacity-70", "cursor-not-allowed");
    btnText.textContent = "Enviando...";
    btnSpinner.classList.remove("hidden");
  } else {
    submitBtn.disabled = false;
    submitBtn.classList.remove("opacity-70", "cursor-not-allowed");
    btnText.textContent = "Enviar Mensaje";
    btnSpinner.classList.add("hidden");
  }
}

  const form = document.getElementById("contact-form");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    setLoading(true);

    try {
      const res = await fetch("/api/sendmail", {
        method: "POST",
        body: formData,
      });

      const text = await res.text();

      if (res.ok && text.trim() === "OK") {
        showToast("Mensaje enviado con éxito", "success");
        form.reset();
      } else {
        showToast("Error al enviar. Intentá nuevamente.", "error");
      }

    } catch (error) {
      showToast("Error de conexión con el servidor.", "error");
    } finally {
      setTimeout(()=>{
        setLoading(false);
      },300);
    }
  });
</script>
