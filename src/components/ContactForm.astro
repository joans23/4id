<form id="contact-form" class="max-w-lg mx-auto bg-white shadow-lg p-8 rounded-lg" data-aos="fade-up">
  <h2 class="text-3xl font-bold text-dark mb-6 text-center">Contáctanos</h2>

  <!-- Honeypot -->
  <input type="text" name="empresa" id="empresa" class="hidden" autocomplete="off" tabindex="-1" />

  <label class="block mb-4">
    <span class="text-dark font-semibold">Nombre*</span>
    <input 
      type="text" 
      name="nombre" 
      required
      class="w-full border p-3 rounded mt-2 focus:outline-none focus:border-[var(--color-primary)]" 
    />
  </label>

  <label class="block mb-4">
    <span class="text-dark font-semibold">Email*</span>
    <input 
      type="email" 
      name="email" 
      required
      class="w-full border p-3 rounded mt-2 focus:outline-none focus:border-[var(--color-primary)]" 
    />
  </label>

  <label class="block mb-6">
    <span class="text-dark font-semibold">Mensaje*</span>
    <textarea 
      name="mensaje" 
      required 
      rows="5"
      class="w-full border p-3 rounded mt-2 focus:outline-none focus:border-[var(--color-primary)]"
    ></textarea>
  </label>

  <button 
    type="submit"
    class="bg-[var(--color-primary)] w-full text-white py-3 font-semibold rounded-lg hover:opacity-90 transition">
    Enviar Mensaje
  </button>
</form>

<!-- Toast container -->
<div id="toast" class="fixed top-5 right-5 z-50 hidden"></div>

<style>
  .toast-msg {
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 10px;
    color: white;
    font-weight: bold;
    animation: fadeIn 0.3s ease, fadeOut 0.3s ease 3s forwards;
  }
  .toast-success {
    background: #F5A623;
  }
  .toast-error {
    background: #d9534f;
  }
  @keyframes fadeIn { 
    from { opacity:0; transform:translateY(-10px); } 
    to { opacity:1; transform:translateY(0); } 
  }
  @keyframes fadeOut { 
    to { opacity:0; transform:translateY(-10px); } 
  }
</style>

<script>
  function showToast(message, type = "success") {
    const toast = document.getElementById("toast");
    const div = document.createElement("div");
    div.className = `toast-msg toast-${type}`;
    div.textContent = message;
    toast.appendChild(div);
    toast.classList.remove("hidden");

    setTimeout(() => div.remove(), 3500);
  }

  const form = document.getElementById("contact-form");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    try {
      const res = await fetch("/api/sendmail", {
        method: "POST",
        body: formData,
      });

      const text = await res.text();

      if (res.ok && text.trim() === "OK") {
        showToast("Mensaje enviado con éxito", "success");
        form.reset();
      } else {
        showToast("Error al enviar. Intentá nuevamente.", "error");
      }

    } catch (error) {
      showToast("Error de conexión con el servidor.", "error");
    }
  });
</script>
